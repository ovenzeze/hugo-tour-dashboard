# åšç‰©é¦†æ•°æ®è‡ªåŠ¨æ”¶é›†è„šæœ¬ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

è¿™ä¸ªè„šæœ¬ä½¿ç”¨ AI/LLM æŠ€æœ¯è‡ªåŠ¨ä»ç½‘ç»œæœé›†åšç‰©é¦†ã€å±•å…å’Œå±•å“ä¿¡æ¯ï¼Œå¹¶å°†å…¶ç»“æ„åŒ–å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ” **æ™ºèƒ½æœç´¢**ï¼šä½¿ç”¨ LLM ä»ç½‘ç»œæœé›†åšç‰©é¦†ç›¸å…³ä¿¡æ¯
- ğŸ›ï¸ **å®Œæ•´æ•°æ®**ï¼šè‡ªåŠ¨æ”¶é›†åšç‰©é¦†åŸºæœ¬ä¿¡æ¯ã€å±•å…å¸ƒå±€ã€é‡è¦å±•å“
- ğŸ”„ **æ‰¹é‡å¤„ç†**ï¼šæ”¯æŒæ‰¹é‡åˆ›å»ºå¤šä¸ªåšç‰©é¦†è®°å½•
- ğŸ“Š **æ•°æ®è¡¥å……**ï¼šä¸ºç°æœ‰åšç‰©é¦†è¡¥å……è¯¦ç»†ä¿¡æ¯
- ğŸ¯ **ç»“æ„åŒ–è¾“å‡º**ï¼šç¡®ä¿æ•°æ®ç¬¦åˆæ•°æ®åº“ç»“æ„è¦æ±‚

## ç¯å¢ƒè¦æ±‚

### å¿…éœ€çš„ç¯å¢ƒå˜é‡

åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®ä»¥ä¸‹å˜é‡ï¼š

```bash
# Supabase æ•°æ®åº“é…ç½®
SUPABASE_URL=your_supabase_url
SUPABASE_KEY=your_supabase_anon_key

# LLM API é…ç½®ï¼ˆè‡³å°‘éœ€è¦å…¶ä¸­ä¸€ä¸ªï¼‰
OPENROUTER_API_KEY=your_openrouter_api_key
GROQ_API_KEY=your_groq_api_key

# å¯é€‰ï¼šæŒ‡å®šé»˜è®¤æ¨¡å‹
OPENROUTER_MODEL=openai/gpt-4o-mini
GROQ_MODEL_NAME=mixtral-8x7b-32768
```

### å®‰è£…ä¾èµ–

```bash
# å®‰è£…ä¾èµ–
pnpm install

# æˆ–è€…å•ç‹¬å®‰è£… tsxï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
pnpm add -D tsx
```

## ä½¿ç”¨æ–¹æ³•

### 1. æŸ¥çœ‹æ•°æ®åº“ç»Ÿè®¡ä¿¡æ¯

```bash
pnpm run museum-enrichment stats
```

æ˜¾ç¤ºå½“å‰æ•°æ®åº“ä¸­åšç‰©é¦†ã€å±•å…ã€å±•å“çš„ç»Ÿè®¡ä¿¡æ¯ã€‚

### 2. æœç´¢åšç‰©é¦†ä¿¡æ¯ï¼ˆä»…æŸ¥çœ‹ï¼Œä¸ä¿å­˜ï¼‰

```bash
pnpm run museum-enrichment search "æ•…å®«åšç‰©é™¢"
```

è¿”å›æ ¼å¼åŒ–çš„ JSON æ•°æ®ï¼ŒåŒ…å«ï¼š
- åšç‰©é¦†åŸºæœ¬ä¿¡æ¯
- ä¸»è¦å±•å…åˆ—è¡¨
- é‡è¦å±•å“ä¿¡æ¯
- æ•°æ®ç½®ä¿¡åº¦å’Œæ¥æº

### 3. æ‰¹é‡åˆ›å»ºæ–°åšç‰©é¦†

```bash
# åˆ›å»ºå•ä¸ªåšç‰©é¦†
pnpm run museum-enrichment create "æ•…å®«åšç‰©é™¢"

# æ‰¹é‡åˆ›å»ºå¤šä¸ªåšç‰©é¦†
pnpm run museum-enrichment create "æ•…å®«åšç‰©é™¢" "å¤§è‹±åšç‰©é¦†" "å¢æµ®å®«" "çº½çº¦å¤§éƒ½ä¼šè‰ºæœ¯åšç‰©é¦†"
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
1. æœç´¢æ¯ä¸ªåšç‰©é¦†çš„è¯¦ç»†ä¿¡æ¯
2. åˆ›å»ºåšç‰©é¦†è®°å½•
3. åˆ›å»ºç›¸å…³çš„å±•å…å’Œå±•å“è®°å½•
4. åœ¨æ¯ä¸ªè¯·æ±‚é—´æ·»åŠ å»¶è¿Ÿä»¥é¿å… API é™åˆ¶

### 4. è¡¥å……ç°æœ‰åšç‰©é¦†ä¿¡æ¯

```bash
# æ ¹æ®åšç‰©é¦† ID è¡¥å……ä¿¡æ¯
pnpm run museum-enrichment enrich 1
```

ä¸ºå·²å­˜åœ¨çš„åšç‰©é¦†æ·»åŠ æˆ–æ›´æ–°ï¼š
- è¯¦ç»†æè¿°ä¿¡æ¯
- å±•å…å¸ƒå±€
- å±•å“ç›®å½•

## æ•°æ®ç»“æ„è¯´æ˜

### åšç‰©é¦†ä¿¡æ¯ (museums)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| museum_id | number | ä¸»é”®ï¼Œè‡ªåŠ¨ç”Ÿæˆ |
| name | string | åšç‰©é¦†åç§° |
| description | string | è¯¦ç»†æè¿° |
| address | string | å®Œæ•´åœ°å€ |
| city | string | åŸå¸‚ |
| country | string | å›½å®¶ |
| website | string | å®˜æ–¹ç½‘ç«™ |
| opening_hours | JSON | å¼€æ”¾æ—¶é—´ |

### å±•å…ä¿¡æ¯ (galleries)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| gallery_id | number | ä¸»é”®ï¼Œè‡ªåŠ¨ç”Ÿæˆ |
| museum_id | number | æ‰€å±åšç‰©é¦†ID |
| name | string | å±•å…åç§° |
| gallery_number | string | å±•å…ç¼–å· |
| description | string | å±•å…æè¿° |
| theme | string | ä¸»é¢˜ |
| location_description | string | ä½ç½®æè¿° |

### å±•å“ä¿¡æ¯ (objects)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| object_id | number | ä¸»é”®ï¼Œè‡ªåŠ¨ç”Ÿæˆ |
| museum_id | number | æ‰€å±åšç‰©é¦†ID |
| gallery_id | number | æ‰€å±å±•å…ID |
| title | string | å±•å“æ ‡é¢˜ |
| artist_display_name | string | è‰ºæœ¯å®¶å§“å |
| culture | string | æ–‡åŒ–èƒŒæ™¯ |
| period | string | å†å²æ—¶æœŸ |
| object_date | string | åˆ›ä½œæ—¥æœŸ |
| medium | string | æè´¨ |
| description | string | å±•å“æè¿° |
| classification | string | åˆ†ç±» |
| tags | string[] | æ ‡ç­¾æ•°ç»„ |

## ç¤ºä¾‹è¾“å‡º

### æœç´¢ç»“æœç¤ºä¾‹

```json
{
  "museum": {
    "name": "æ•…å®«åšç‰©é™¢",
    "description": "ä½äºåŒ—äº¬å¸‚ä¸­å¿ƒçš„æ˜æ¸…ä¸¤ä»£çš‡å®«ï¼Œæ˜¯ä¸–ç•Œä¸Šç°å­˜è§„æ¨¡æœ€å¤§ã€ä¿å­˜æœ€ä¸ºå®Œæ•´çš„æœ¨è´¨ç»“æ„å¤å»ºç­‘ç¾¤",
    "address": "åŒ—äº¬å¸‚ä¸œåŸåŒºæ™¯å±±å‰è¡—4å·",
    "city": "åŒ—äº¬",
    "country": "ä¸­å›½",
    "website": "https://www.dpm.org.cn",
    "opening_hours": {
      "tuesday": "8:30-17:00",
      "wednesday": "8:30-17:00",
      "thursday": "8:30-17:00",
      "friday": "8:30-17:00",
      "saturday": "8:30-17:00",
      "sunday": "8:30-17:00",
      "monday": "é—­é¦†"
    },
    "galleries": [
      {
        "name": "åˆé—¨å±•å…",
        "gallery_number": "G001",
        "description": "æ•…å®«åšç‰©é™¢çš„ä¸»è¦å±•è§ˆå…",
        "theme": "å®«å»·æ–‡åŒ–",
        "location_description": "åˆé—¨åŸæ¥¼",
        "objects": [
          {
            "title": "æ¸…ä¹¾éš†ç²‰å½©ç“·ç“¶",
            "object_number": "QG001",
            "artist_display_name": "å®«å»·é€ åŠå¤„",
            "culture": "ä¸­å›½",
            "period": "æ¸…ä»£",
            "object_date": "ä¹¾éš†å¹´é—´",
            "medium": "é™¶ç“·",
            "description": "ç²¾ç¾çš„ç²‰å½©è£…é¥°ç“·ç“¶",
            "classification": "é™¶ç“·",
            "department": "é™¶ç“·éƒ¨",
            "tags": ["é™¶ç“·", "ç²‰å½©", "æ¸…ä»£", "ä¹¾éš†"]
          }
        ]
      }
    ]
  },
  "confidence": 0.95,
  "sources": ["æ•…å®«åšç‰©é™¢å®˜ç½‘", "ç»´åŸºç™¾ç§‘", "æ–‡åŒ–é—äº§ç½‘"]
}
```

## æ³¨æ„äº‹é¡¹

### ğŸš¨ é‡è¦æé†’

1. **API é…é¢**ï¼šè„šæœ¬ä¼šè°ƒç”¨ LLM APIï¼Œè¯·æ³¨æ„ API ä½¿ç”¨é…é¢
2. **æ•°æ®è´¨é‡**ï¼šAI ç”Ÿæˆçš„æ•°æ®å¯èƒ½éœ€è¦äººå·¥éªŒè¯å’Œä¿®æ­£
3. **é‡å¤åˆ›å»º**ï¼šé¿å…é‡å¤åˆ›å»ºç›¸åŒçš„åšç‰©é¦†è®°å½•
4. **ç½‘ç»œè¿æ¥**ï¼šç¡®ä¿ç½‘ç»œè¿æ¥ç¨³å®šï¼Œæœç´¢è¿‡ç¨‹å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´

### æ€§èƒ½ä¼˜åŒ–

- è„šæœ¬åœ¨æ‰¹é‡å¤„ç†æ—¶ä¼šè‡ªåŠ¨æ·»åŠ å»¶è¿Ÿ
- å»ºè®®åˆ†æ‰¹å¤„ç†å¤§é‡åšç‰©é¦†ï¼Œé¿å…è¶…æ—¶
- å¯ä»¥å…ˆç”¨ `search` å‘½ä»¤æµ‹è¯•å•ä¸ªåšç‰©é¦†çš„æ•°æ®è´¨é‡

### é”™è¯¯å¤„ç†

- å¦‚æœæŸä¸ªåšç‰©é¦†æœç´¢å¤±è´¥ï¼Œè„šæœ¬ä¼šç»§ç»­å¤„ç†å…¶ä»–åšç‰©é¦†
- æ£€æŸ¥æ§åˆ¶å°è¾“å‡ºäº†è§£è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- ç¡®ä¿ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®

## é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰æœç´¢

å¯ä»¥ä¿®æ”¹è„šæœ¬ä¸­çš„ `prompt` å†…å®¹æ¥ï¼š
- è°ƒæ•´æœç´¢çš„è¯¦ç»†ç¨‹åº¦
- æ·»åŠ ç‰¹å®šçš„æ•°æ®å­—æ®µ
- ä¼˜åŒ–ç‰¹å®šç±»å‹åšç‰©é¦†çš„æ•°æ®æ”¶é›†

### é›†æˆåˆ°å·¥ä½œæµ

```bash
# ç¤ºä¾‹ï¼šè‡ªåŠ¨åŒ–å·¥ä½œæµ
#!/bin/bash

# 1. æ›´æ–°æ•°æ®åº“ç»Ÿè®¡
pnpm run museum-enrichment stats

# 2. æ‰¹é‡æ·»åŠ ä¸–ç•ŒçŸ¥ååšç‰©é¦†
museums=(
  "å¤§è‹±åšç‰©é¦†"
  "å¢æµ®å®«"
  "çº½çº¦å¤§éƒ½ä¼šè‰ºæœ¯åšç‰©é¦†"
  "æ•…å®«åšç‰©é™¢"
  "æ¢µè’‚å†ˆåšç‰©é¦†"
)

for museum in "${museums[@]}"; do
  echo "æ­£åœ¨å¤„ç†: $museum"
  pnpm run museum-enrichment create "$museum"
  sleep 5  # æ·»åŠ å»¶è¿Ÿ
done

# 3. æ˜¾ç¤ºæœ€ç»ˆç»Ÿè®¡
pnpm run museum-enrichment stats
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **API Key é”™è¯¯**
   ```
   é”™è¯¯: LLM API key not configured
   è§£å†³: æ£€æŸ¥ .env æ–‡ä»¶ä¸­çš„ API key é…ç½®
   ```

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```
   é”™è¯¯: Supabase URL and Key must be configured
   è§£å†³: ç¡®è®¤ SUPABASE_URL å’Œ SUPABASE_KEY é…ç½®æ­£ç¡®
   ```

3. **JSON è§£æé”™è¯¯**
   ```
   é”™è¯¯: Unexpected token in JSON
   è§£å†³: LLM è¿”å›æ ¼å¼å¯èƒ½ä¸è§„èŒƒï¼Œå¯é‡è¯•æˆ–æ£€æŸ¥æ¨¡å‹é…ç½®
   ```

### è°ƒè¯•æ¨¡å¼

ä¿®æ”¹è„šæœ¬å¼€å¤´çš„æ—¥å¿—çº§åˆ«ï¼š

```typescript
// åœ¨è„šæœ¬é¡¶éƒ¨æ·»åŠ 
consola.level = 4  // æ˜¾ç¤ºè¯¦ç»†è°ƒè¯•ä¿¡æ¯
```

## è´¡çŒ®

å¦‚æœæ‚¨å‘ç°è„šæœ¬æœ‰æ”¹è¿›ç©ºé—´ï¼Œæ¬¢è¿ï¼š
- æäº¤ issue æŠ¥å‘Šé—®é¢˜
- æäº¤ PR æ”¹è¿›åŠŸèƒ½
- åˆ†äº«ä½¿ç”¨ç»éªŒå’Œæœ€ä½³å®è·µ 