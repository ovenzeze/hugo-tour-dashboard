# Persona Audio Preview Feature

## æ¦‚è¿°

æ­¤åŠŸèƒ½ä¸ºPersonaå¡ç‰‡æ·»åŠ äº†è¯­éŸ³è¯•å¬åŠŸèƒ½ã€‚å½“Personaå·²ç”Ÿæˆè¿‡è¯­éŸ³æ—¶ï¼Œç”¨æˆ·å¯ä»¥åœ¨å¡ç‰‡ä¸Šç›´æ¥è¯•å¬æœ€æ–°çš„éŸ³é¢‘æ ·æœ¬ã€‚

## æ•°æ®å…³è”æœºåˆ¶

### å±‚å±‚å…³è”çš„æ•°æ®ç»“æ„

```
1. Persona (äººç‰©æ¡£æ¡ˆ)
   â†“ (é€šè¿‡nameå­—æ®µå…³è”)
2. podcast_segments.speaker (ç‰‡æ®µå‘è¨€äºº)
   â†“ (é€šè¿‡segment_text_idå…³è”)
3. segment_audios.segment_id (éŸ³é¢‘ç‰‡æ®µ)
   â†“ (åŒ…å«å®é™…çš„éŸ³é¢‘æ–‡ä»¶)
4. segment_audios.audio_url (éŸ³é¢‘æ–‡ä»¶URL)
```

### å…³è”æŸ¥è¯¢é€»è¾‘

```sql
SELECT 
  personas.name,
  podcast_segments.*,
  segment_audios.*
FROM personas
JOIN podcast_segments ON personas.name = podcast_segments.speaker
JOIN segment_audios ON podcast_segments.segment_text_id = segment_audios.segment_id
WHERE personas.persona_id = ? 
  AND segment_audios.audio_url IS NOT NULL
ORDER BY segment_audios.created_at DESC
LIMIT 5
```

## æŠ€æœ¯å®ç°

### 1. åç«¯API

**æ–‡ä»¶**: `server/api/personas/[id]/audio-samples.get.ts`

- è·å–æŒ‡å®šPersonaçš„éŸ³é¢‘æ ·æœ¬
- é€šè¿‡å¤šè¡¨å…³è”æŸ¥è¯¢æ‰¾åˆ°å¯¹åº”çš„éŸ³é¢‘æ–‡ä»¶
- è¿”å›æœ€å¤š5ä¸ªæœ€æ–°çš„éŸ³é¢‘æ ·æœ¬

**å“åº”æ ¼å¼**:
```typescript
interface AudioSamplesResponse {
  success: boolean
  persona_id: number
  persona_name: string
  samples: AudioSample[]
  message: string
}

interface AudioSample {
  audio_url: string
  segment_text: string
  created_at: string
  podcast_title?: string
  duration_ms?: number
}
```

### 2. å‰ç«¯Composable

**æ–‡ä»¶**: `composables/usePersonaAudioPreview.ts`

æ ¸å¿ƒåŠŸèƒ½ï¼š
- **ç¼“å­˜ç®¡ç†**: é¿å…é‡å¤è¯·æ±‚ç›¸åŒPersonaçš„éŸ³é¢‘æ•°æ®
- **æ’­æ”¾æ§åˆ¶**: æ”¯æŒæ’­æ”¾/æš‚åœï¼Œè‡ªåŠ¨åœæ­¢å…¶ä»–æ­£åœ¨æ’­æ”¾çš„éŸ³é¢‘
- **é¢„åŠ è½½**: å¯æ‰¹é‡é¢„åŠ è½½å¤šä¸ªPersonaçš„éŸ³é¢‘æ ·æœ¬
- **çŠ¶æ€è·Ÿè¸ª**: è·Ÿè¸ªåŠ è½½çŠ¶æ€å’Œæ’­æ”¾çŠ¶æ€

ä¸»è¦æ–¹æ³•ï¼š
```typescript
// æ£€æŸ¥æ˜¯å¦æœ‰éŸ³é¢‘æ ·æœ¬
hasAudioSamples(personaId: number): boolean

// è·å–é¢„è§ˆæ ·æœ¬ï¼ˆæœ€æ–°çš„éŸ³é¢‘ï¼‰
getPreviewSample(personaId: number): AudioSample | null

// è·å–éŸ³é¢‘æ ·æœ¬
fetchAudioSamples(personaId: number): Promise<AudioSample[]>

// æ’­æ”¾/æš‚åœåˆ‡æ¢
toggleAudioPlayback(personaId: number): Promise<void>

// æ‰¹é‡é¢„åŠ è½½
preloadAudioSamples(personaIds: number[]): Promise<void>
```

### 3. UIç»„ä»¶æ›´æ–°

**æ–‡ä»¶**: `components/PersonaCard.vue`

**æ–°å¢åŠŸèƒ½**:
- éŸ³é¢‘è¯•å¬æŒ‰é’®
- æ’­æ”¾çŠ¶æ€æŒ‡ç¤º
- éŸ³é¢‘ä¿¡æ¯æ˜¾ç¤ºï¼ˆæ—¶é•¿ã€æ–‡æœ¬é¢„è§ˆï¼‰
- è‡ªåŠ¨æ£€æµ‹Personaæ˜¯å¦é…ç½®äº†è¯­éŸ³

**æ˜¾ç¤ºé€»è¾‘**:
```typescript
// åªæœ‰å½“Personaé…ç½®äº†è¯­éŸ³ä¸”æœ‰éŸ³é¢‘æ ·æœ¬æ—¶æ‰æ˜¾ç¤ºè¯•å¬åŒºåŸŸ
const shouldShowAudioSection = computed(() => {
  const hasVoiceConfig = persona.voice_model_identifier && persona.tts_provider
  return hasVoiceConfig && (hasAudioPreview || isLoadingAudio)
})
```

**UIå…ƒç´ **:
- ğŸ”Š æ’­æ”¾æŒ‰é’®ï¼ˆåŠ¨æ€æ˜¾ç¤ºæ’­æ”¾/æš‚åœçŠ¶æ€ï¼‰
- éŸ³é¢‘æ—¶é•¿æ˜¾ç¤º
- ç‰‡æ®µæ–‡æœ¬é¢„è§ˆï¼ˆæœ€å¤š50å­—ç¬¦ï¼‰
- æ’­å®¢æ ‡é¢˜ï¼ˆå¦‚æœæœ‰ï¼‰

## ç”¨æˆ·ä½“éªŒ

### 1. è‡ªåŠ¨è¡Œä¸º
- **é¢„åŠ è½½**: é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨ä¸ºé…ç½®äº†è¯­éŸ³çš„æ´»è·ƒPersonaé¢„åŠ è½½éŸ³é¢‘æ ·æœ¬
- **æ™ºèƒ½æ˜¾ç¤º**: åªæœ‰çœŸæ­£æœ‰éŸ³é¢‘å¯ç”¨æ—¶æ‰æ˜¾ç¤ºè¯•å¬åŒºåŸŸ
- **çŠ¶æ€åé¦ˆ**: åŠ è½½æ—¶æ˜¾ç¤ºspinnerï¼Œæ’­æ”¾æ—¶æ˜¾ç¤ºåœæ­¢æŒ‰é’®

### 2. äº¤äº’è®¾è®¡
- **ä¸€é”®è¯•å¬**: ç‚¹å‡»æ’­æ”¾æŒ‰é’®å³å¯è¯•å¬æœ€æ–°éŸ³é¢‘æ ·æœ¬
- **è‡ªåŠ¨åœæ­¢**: æ’­æ”¾æ–°éŸ³é¢‘æ—¶è‡ªåŠ¨åœæ­¢å…¶ä»–æ­£åœ¨æ’­æ”¾çš„éŸ³é¢‘
- **æ—¶é•¿é™åˆ¶**: è¯•å¬æœ€é•¿10ç§’ï¼Œé˜²æ­¢è¿‡é•¿æ’­æ”¾
- **é”™è¯¯å¤„ç†**: ç½‘ç»œæˆ–éŸ³é¢‘é”™è¯¯æ—¶æ˜¾ç¤ºå‹å¥½æç¤º

### 3. æ€§èƒ½ä¼˜åŒ–
- **æŒ‰éœ€åŠ è½½**: åªä¸ºéœ€è¦çš„PersonaåŠ è½½éŸ³é¢‘æ•°æ®
- **ç¼“å­˜æœºåˆ¶**: é¿å…é‡å¤è¯·æ±‚ç›¸åŒæ•°æ®
- **èµ„æºæ¸…ç†**: ç»„ä»¶å¸è½½æ—¶æ¸…ç†éŸ³é¢‘èµ„æº

## æµ‹è¯•

### æµ‹è¯•é¡µé¢
**æ–‡ä»¶**: `pages/test/persona-audio.vue`

æä¾›å®Œæ•´çš„æµ‹è¯•ç¯å¢ƒï¼š
- æ˜¾ç¤ºæ‰€æœ‰PersonaåŠå…¶è¯­éŸ³é…ç½®çŠ¶æ€
- è¿‡æ»¤å™¨ï¼ˆçŠ¶æ€ã€è¯­éŸ³é…ç½®ï¼‰
- å®æ—¶çŠ¶æ€ç›‘æ§
- è°ƒè¯•ä¿¡æ¯æ˜¾ç¤º

### æµ‹è¯•è®¿é—®
```
http://localhost:3000/test/persona-audio
```

## å®‰å…¨è€ƒè™‘

1. **APIæƒé™**: éœ€è¦é€‚å½“çš„èº«ä»½éªŒè¯å’Œæƒé™æ£€æŸ¥
2. **æ–‡ä»¶è®¿é—®**: éŸ³é¢‘æ–‡ä»¶è·¯å¾„éœ€è¦éªŒè¯ï¼Œé˜²æ­¢è·¯å¾„éå†æ”»å‡»
3. **èµ„æºé™åˆ¶**: é™åˆ¶å•æ¬¡è¿”å›çš„éŸ³é¢‘æ ·æœ¬æ•°é‡
4. **é”™è¯¯å¤„ç†**: ä¸æš´éœ²æ•æ„Ÿçš„æœåŠ¡å™¨é”™è¯¯ä¿¡æ¯

## æ‰©å±•å¯èƒ½

1. **éŸ³é¢‘æ ¼å¼æ”¯æŒ**: æ”¯æŒæ›´å¤šéŸ³é¢‘æ ¼å¼ï¼ˆç›®å‰ä¸»è¦æ”¯æŒå¸¸è§WebéŸ³é¢‘æ ¼å¼ï¼‰
2. **æ’­æ”¾åˆ—è¡¨**: æ”¯æŒæ’­æ”¾Personaçš„å¤šä¸ªéŸ³é¢‘æ ·æœ¬
3. **éŸ³é¢‘å¯è§†åŒ–**: æ·»åŠ éŸ³é¢‘æ³¢å½¢æˆ–é¢‘è°±æ˜¾ç¤º
4. **åˆ†äº«åŠŸèƒ½**: å…è®¸åˆ†äº«ç‰¹å®šPersonaçš„éŸ³é¢‘æ ·æœ¬
5. **éŸ³è´¨é€‰æ‹©**: æ”¯æŒä¸åŒéŸ³è´¨çš„éŸ³é¢‘ç‰ˆæœ¬

## æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

1. **éŸ³é¢‘ä¸æ˜¾ç¤º**
   - æ£€æŸ¥Personaæ˜¯å¦é…ç½®äº†`voice_model_identifier`å’Œ`tts_provider`
   - ç¡®è®¤æ•°æ®åº“ä¸­å­˜åœ¨ç›¸å…³çš„éŸ³é¢‘è®°å½•
   - æ£€æŸ¥APIæ˜¯å¦æ­£å¸¸è¿”å›æ•°æ®

2. **æ’­æ”¾å¤±è´¥**
   - æ£€æŸ¥éŸ³é¢‘æ–‡ä»¶URLæ˜¯å¦å¯è®¿é—®
   - ç¡®è®¤æµè§ˆå™¨æ”¯æŒè¯¥éŸ³é¢‘æ ¼å¼
   - æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒCORSè®¾ç½®

3. **æ€§èƒ½é—®é¢˜**
   - æ£€æŸ¥æ˜¯å¦é¢„åŠ è½½äº†è¿‡å¤šPersonaçš„éŸ³é¢‘
   - ç¡®è®¤éŸ³é¢‘æ–‡ä»¶å¤§å°åˆç†
   - æ£€æŸ¥ç¼“å­˜æ˜¯å¦æ­£å¸¸å·¥ä½œ

### è°ƒè¯•å·¥å…·

ä½¿ç”¨æµ‹è¯•é¡µé¢çš„è°ƒè¯•ä¿¡æ¯æŸ¥çœ‹ï¼š
- éŸ³é¢‘æ ·æœ¬åŠ è½½çŠ¶æ€
- å½“å‰æ’­æ”¾çŠ¶æ€
- ç¼“å­˜æ•°æ®æƒ…å†µ
- ç½‘ç»œè¯·æ±‚çŠ¶æ€ 